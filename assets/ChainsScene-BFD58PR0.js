import{d as z,b as te,e as C,f as b,n as I,o as M,_ as K,F as ie,g as ue,i as ce,r as y,w as de,a as ve,u as V,t as Z,h as he,j as ne,k as $e,l as be,m as ae,c as xe}from"./index-CLjOvJ4p.js";const Ie=["height","width"],Te=["cx","cy","r"],Ee=b("rect",{fill:"url(#dots-pattern)",height:"100%",width:"100%",x:"0",y:"0"},null,-1),ke=z({__name:"ChainsGrid",props:{scale:{default:1}},setup(e){const o=e,n=te(()=>40*o.scale),l=te(()=>2*o.scale);return(c,r)=>(M(),C("svg",{class:I(c.$style.root)},[b("pattern",{height:n.value,width:n.value,id:"dots-pattern",patternUnits:"userSpaceOnUse"},[b("circle",{cx:l.value,cy:l.value,r:l.value/2},null,8,Te)],8,Ie),Ee],2))}}),_e="gcppe",Se={root:_e},Oe={$style:Se},Le=K(ke,[["__cssModules",Oe]]),Me=z({__name:"ChainsLines",props:{lines:{default:()=>({})}},setup(e){const o=n=>{const l=Math.sqrt((n.x2-n.x1)*(n.x2-n.x1)+(n.y2-n.y1)*(n.y2-n.y1))*.25;return`M ${n.x1}, ${n.y1} C ${n.x1}, ${n.y1+l}, ${n.x2}, ${n.y2-l}, ${n.x2}, ${n.y2}`};return(n,l)=>(M(),C("svg",{class:I(n.$style.root),height:"100%",width:"100%"},[b("g",null,[(M(!0),C(ie,null,ue(n.lines,(c,r,p,a)=>{const d=[c.x1,c.y1,c.x2,c.y2];if(a&&a.key===r&&ce(a,d))return a;const m=(M(),C("path",{d:o(c),key:r},null,8,["d"]));return m.memo=d,m},l,0),128))])],2))}}),je="AKtmf",we={root:je},Be={$style:we},Pe=K(Me,[["__cssModules",Be]]);var H=(e=>(e[e.Block=0]="Block",e))(H||{}),Y=(e=>(e[e.Input=0]="Input",e[e.Output=1]="Output",e))(Y||{});const Ce=["data-block-type","id"],Ne=["data-event-type"],Ae=b("br",null,null,-1),Fe=["data-event-type"],Xe=z({__name:"ChainsSceneBlock",props:{block:{default:()=>({id:-1,parentId:null,type:"StatusActionHandler",x:0,y:0})},dragging:{type:Boolean,default:!1},selected:{type:Boolean,default:!1}},setup(e){const o=e,n=y(null),l=()=>{n.value&&(n.value.style.transform=`translate3d(${o.block.x}px, ${o.block.y}px, 0)`)},c=y(null);return de(()=>o,()=>{c.value&&cancelAnimationFrame(c.value),c.value=requestAnimationFrame(l)},{deep:!0,flush:"post"}),ve(l),(r,p)=>(M(),C("div",{class:I([r.$style.root,{[r.$style.dragging]:r.dragging,[r.$style.selected]:r.selected}]),"data-block-type":V(H).Block,id:String(r.block.id),ref_key:"blockEl",ref:n},[b("div",{class:I([r.$style.connectionPoint,r.$style.connectionPointInput]),"data-event-type":V(Y).Input},null,10,Ne),b("div",{class:I(r.$style.header)},[b("span",{class:I(r.$style.text)}," id: "+Z(r.block.id),3)],2),b("div",{class:I(r.$style.content)},[he(r.$slots,"default",{},()=>[b("code",null,[ne(" x: "+Z(r.block.x)+" ",1),Ae,ne(" y: "+Z(r.block.y),1)])])],2),b("div",{class:I([r.$style.connectionPoint,r.$style.connectionPointOutput]),"data-event-type":V(Y).Output},null,10,Fe)],10,Ce))}}),Ye="XQzGs",Re="GnFWy",We="OHtMT",De="HLkRn",Ge="YaYXt",He="L-061",Ue="iXiS3",qe="jmllp",ze="_52kBY",Ke={root:Ye,dragging:Re,selected:We,header:De,text:Ge,content:He,connectionPoint:Ue,connectionPointInput:qe,connectionPointOutput:ze},Ve={$style:Ke},Ze=K(Xe,[["__cssModules",Ve]]);var Qe=typeof global=="object"&&global&&global.Object===Object&&global,Je=typeof self=="object"&&self&&self.Object===Object&&self,fe=Qe||Je||Function("return this")(),U=fe.Symbol,ye=Object.prototype,et=ye.hasOwnProperty,tt=ye.toString,X=U?U.toStringTag:void 0;function nt(e){var o=et.call(e,X),n=e[X];try{e[X]=void 0;var l=!0}catch{}var c=tt.call(e);return l&&(o?e[X]=n:delete e[X]),c}var at=Object.prototype,lt=at.toString;function st(e){return lt.call(e)}var ot="[object Null]",rt="[object Undefined]",le=U?U.toStringTag:void 0;function it(e){return e==null?e===void 0?rt:ot:le&&le in Object(e)?nt(e):st(e)}function ut(e){return e!=null&&typeof e=="object"}var ct="[object Symbol]";function dt(e){return typeof e=="symbol"||ut(e)&&it(e)==ct}var vt=/\s/;function ft(e){for(var o=e.length;o--&&vt.test(e.charAt(o)););return o}var yt=/^\s+/;function pt(e){return e&&e.slice(0,ft(e)+1).replace(yt,"")}function q(e){var o=typeof e;return e!=null&&(o=="object"||o=="function")}var se=NaN,mt=/^[-+]0x[0-9a-f]+$/i,gt=/^0b[01]+$/i,ht=/^0o[0-7]+$/i,$t=parseInt;function oe(e){if(typeof e=="number")return e;if(dt(e))return se;if(q(e)){var o=typeof e.valueOf=="function"?e.valueOf():e;e=q(o)?o+"":o}if(typeof e!="string")return e===0?e:+e;e=pt(e);var n=gt.test(e);return n||ht.test(e)?$t(e.slice(2),n?2:8):mt.test(e)?se:+e}var Q=function(){return fe.Date.now()},bt="Expected a function",xt=Math.max,It=Math.min;function Tt(e,o,n){var l,c,r,p,a,d,m=0,x=!1,g=!1,j=!0;if(typeof e!="function")throw new TypeError(bt);o=oe(o)||0,q(n)&&(x=!!n.leading,g="maxWait"in n,r=g?xt(oe(n.maxWait)||0,o):r,j="trailing"in n?!!n.trailing:j);function h(u){var T=l,B=c;return l=c=void 0,m=u,p=e.apply(B,T),p}function w(u){return m=u,a=setTimeout(S,o),x?h(u):p}function N(u){var T=u-d,B=u-m,O=o-T;return g?It(O,r-B):O}function $(u){var T=u-d,B=u-m;return d===void 0||T>=o||T<0||g&&B>=r}function S(){var u=Q();if($(u))return F(u);a=setTimeout(S,N(u))}function F(u){return a=void 0,j&&l?h(u):(l=c=void 0,p)}function R(){a!==void 0&&clearTimeout(a),m=0,l=d=c=a=void 0}function W(){return a===void 0?p:F(Q())}function A(){var u=Q(),T=$(u);if(l=arguments,c=this,d=u,T){if(a===void 0)return w(d);if(g)return clearTimeout(a),a=setTimeout(S,o),h(d)}return a===void 0&&(a=setTimeout(S,o)),p}return A.cancel=R,A.flush=W,A}var Et="Expected a function";function D(e,o,n){var l=!0,c=!0;if(typeof e!="function")throw new TypeError(Et);return q(n)&&(l="leading"in n?!!n.leading:l,c="trailing"in n?!!n.trailing:c),Tt(e,o,{leading:l,maxWait:o,trailing:c})}const re={max:2,min:.1},kt=.2,_={height:98,width:168},G=6,_t=z({__name:"ChainsScene",props:{value:{default:()=>({})}},emits:["update:value"],setup(e){const o=e,n=y(null),l=y(null),c=y(null),r=y(null),p=y(null),a=y({}),d=y({}),m=y(null),x=y({x:0,y:0}),g=y(1),j=y(!1),h=y(null),w=y({}),N=y({left:0,top:0}),$=y({x:0,y:0}),S=y({x:0,y:0}),F=D(t=>{var i;t.preventDefault();const s=t.target;if(s===c.value&&(w.value={},j.value=!0,$.value.x=t.clientX,$.value.y=t.clientY),(i=r.value)!=null&&i.contains(s)){t.stopPropagation();const v=s.closest("[data-block-type]");if(v){const f=Number(v.id);if(Number(v.dataset.blockType)===H.Block){h.value=f,$.value.x=t.clientX-a.value[f].x*g.value,$.value.y=t.clientY-a.value[f].y*g.value;const L=s.closest("[data-event-type]");L&&Number(L.dataset.eventType)===Y.Output&&(h.value=null,m.value=f)}}}},G),R=D(t=>{if(t.preventDefault(),t.stopPropagation(),j.value&&(x.value.x+=t.clientX-$.value.x,x.value.y+=t.clientY-$.value.y,$.value.x=t.clientX,$.value.y=t.clientY),h.value!==null){a.value[h.value].x=(t.clientX-$.value.x)/g.value,a.value[h.value].y=(t.clientY-$.value.y)/g.value;const s=a.value[h.value];p.value&&cancelAnimationFrame(p.value),p.value=requestAnimationFrame(()=>me(s))}if(m.value!==null){S.value.x=(t.clientX-$.value.x)/g.value,S.value.y=(t.clientY-$.value.y)/g.value;const s=a.value[m.value];p.value&&cancelAnimationFrame(p.value),p.value=requestAnimationFrame(()=>ge(s))}},G),W=D(t=>{var i,v;t.preventDefault(),t.stopPropagation();const s=t.target;if(w.value={},h.value!==null&&(w.value[h.value]=!0),m.value!==null){const f=a.value[m.value],k=u(f.id,void 0);if(d.value[k]&&delete d.value[k],(i=r.value)!=null&&i.contains(s)){const P=s.closest("[data-block-type]");if(P){const E=Number(P.id);if(Number(P.dataset.blockType)===H.Block){const ee=s.closest("[data-event-type]");if(ee&&Number(ee.dataset.eventType)===Y.Input){if(m.value===E)return;delete d.value[u(f.id,void 0)],a.value[E].parentId&&O.value[(v=a.value[E])==null?void 0:v.parentId]&&(delete d.value[u(E,a.value[E].parentId)],delete O.value[a.value[E].parentId][E],O.value[f.id][E]=!0),a.value[E].parentId=f.id,d.value[u(E,f.id)]={x1:f.x+_.width/2,x2:a.value[E].x+_.width/2,y1:f.y+_.height,y2:a.value[E].y},m.value=null}}}}}j.value=!1,h.value=null,m.value=null},G),A=D(t=>{if(t.preventDefault(),t.stopPropagation(),!l.value)return;const s=g.value,i=Math.min(Math.max(Math.exp(Math.log(s)+Math.sign(-t.deltaY)*kt),re.min),re.max),v=t.clientX-N.value.left,f=t.clientY-N.value.top,k=(v-x.value.x)/s,L=(f-x.value.y)/s;g.value=i,x.value.x=v-k*i,x.value.y=f-L*i},G),u=(t,s)=>`${s}:${t}`,T=(t,s)=>({x1:s.x+_.width/2,x2:t.x+_.width/2,y1:s.y+_.height,y2:t.y}),B=t=>{const s={};for(const i in t){const v=t[i];if(v.parentId!==null){const f=t[v.parentId];f&&(s[u(v.id,f.id)]=T(v,f))}}return s},O=y({}),pe=t=>{const s={};for(const i in t)s[i]={};for(const i in t){const v=t[i];v.parentId!==null&&(s[v.parentId]||(s[v.parentId]={}),s[v.parentId][v.id]=!0)}return s},me=t=>{t.parentId!==null&&a.value[t.parentId]&&(d.value[u(t.id,t.parentId)]=T(t,a.value[t.parentId]));const s=O.value[t.id];if(Object.keys(s).length)for(const i in s)a.value[i]&&(d.value[u(Number(i),t.id)]=T(a.value[i],t))},ge=t=>{m.value!==null&&(d.value[u(t.id,void 0)]={x1:t.x+_.width/2,x2:S.value.x+_.width/2,y1:t.y+_.height,y2:S.value.y+_.height})},J=()=>{r.value&&(r.value.style.transform=`translate3d(${x.value.x}px, ${x.value.y}px, 0) scale(${g.value})`)};return de(()=>x.value,()=>{p.value&&cancelAnimationFrame(p.value),p.value=requestAnimationFrame(J)},{deep:!0,flush:"post"}),ve(async()=>{if(await $e(),a.value={...o.value},d.value=B(a.value),O.value=pe(a.value),l.value){const{left:t,top:s}=l.value.getBoundingClientRect();N.value.left=t,N.value.top=s,x.value.x=l.value.clientWidth/2,x.value.y=l.value.clientHeight/2}l.value&&(l.value.addEventListener("mousedown",F),l.value.addEventListener("wheel",A,!0)),document.documentElement.addEventListener("mousemove",R,!0),document.documentElement.addEventListener("mouseup",W,!0),J()}),be(()=>{l.value&&(l.value.removeEventListener("mousedown",F),l.value.removeEventListener("wheel",A)),document.documentElement.removeEventListener("mousemove",R),document.documentElement.removeEventListener("mouseup",W)}),(t,s)=>(M(),C("div",{class:I(t.$style.root),ref_key:"rootEl",ref:n},[b("div",{class:I(t.$style.canvas),ref_key:"canvasEl",ref:l},[b("div",{class:I(t.$style.renderer),ref_key:"rendererEl",ref:c},[ae(Le,{class:I(t.$style.grid),scale:g.value},null,8,["class","scale"]),b("div",{class:I(t.$style.blocks),ref_key:"blocksEl",ref:r},[b("div",{class:I(t.$style.center)},null,2),ae(Pe,{lines:d.value},null,8,["lines"]),(M(!0),C(ie,null,ue(a.value,(i,v,f,k)=>{const L=[i.x,i.y,i.id===h.value,w.value[i.id]];if(k&&k.key===i.id&&ce(k,L))return k;const P=(M(),xe(Ze,{block:i,dragging:i.id===h.value,key:i.id,selected:w.value[i.id]},null,8,["block","dragging","selected"]));return P.memo=L,P},s,0),128))],2)],2)],2)],2))}}),St="NFkR4",Ot="PPdPK",Lt="Gg8MK",Mt="ulWdA",jt="TG-Ar",wt="tn4FV",Bt={root:St,canvas:Ot,renderer:Lt,grid:Mt,blocks:jt,center:wt},Pt={$style:Bt},Ft=K(_t,[["__cssModules",Pt]]);export{Ft as C};
