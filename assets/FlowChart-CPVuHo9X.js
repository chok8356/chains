import{d as I,a as S,o as $,b as M,e as u,n as f,_ as F,t as L,f as ee,w as N,g as R,h as A,r as g,i as T,j as te,k as ne,l as se,F as V,m as Y,c as k,p as oe,q as z}from"./index-CvoYUlm0.js";const X={max:2,min:.1},ae=.2,P={height:98,width:168},re=["height","patternTransform","width","x","y"],le=["cx","cy","r"],ce=u("rect",{fill:"url(#dots-pattern)",height:"100%",width:"100%",x:"0",y:"0"},null,-1),ie=I({__name:"FlowChartGrid",props:{scene:{}},setup(w){const h=w,v=S(()=>40*h.scene.scale),o=S(()=>2*h.scene.scale);return(c,d)=>($(),M("svg",{class:f(c.$style.root)},[u("pattern",{height:v.value,patternTransform:`translate(-${o.value},-${o.value})`,width:v.value,x:c.scene.center.x,y:c.scene.center.y,id:"dots-pattern",patternUnits:"userSpaceOnUse"},[u("circle",{cx:o.value,cy:o.value,r:o.value/2},null,8,le)],8,re),ce],2))}}),ue="-H6Fm",de={root:ue},ve={$style:de},pe=F(ie,[["__cssModules",ve]]),ye=["d"],me=I({__name:"FlowChartLine",props:{line:{}},setup(w){const h=w,v=S(()=>{const{end:o,start:c}=h.line,d=Math.sqrt((o.x-c.x)*(o.x-c.x)+(o.y-c.y)*(o.y-c.y))*.25;return`M ${c.x}, ${c.y} C ${c.x}, ${c.y+d}, ${o.x}, ${o.y-d}, ${o.x}, ${o.y}`});return(o,c)=>($(),M("svg",{class:f(o.$style.root),height:"100%",width:"100%"},[u("g",null,[u("path",{d:v.value},null,8,ye)])],2))}}),fe="_4PhXY",he={root:fe},$e={$style:he},q=F(me,[["__cssModules",$e]]),ge=u("br",null,null,-1),we=I({__name:"FlowChartNode",props:{dragging:{type:Boolean},node:{},selected:{type:Boolean}},emits:["input","output"],setup(w,{emit:h}){const v=w,o=h,c=()=>{o("input")},d=()=>{o("output")};return(r,p)=>($(),M("div",{class:f([r.$style.root,{[r.$style.dragging]:r.dragging,[r.$style.selected]:r.selected}]),style:R({transform:`translate3d(${v.node.x}px, ${v.node.y}px, 0)`})},[u("div",{class:f([r.$style.connectionPoint,r.$style.connectionPointInput]),onMouseupPassiveCapture:c},null,34),u("div",{class:f(r.$style.header)},[u("span",{class:f(r.$style.text)}," id: "+L(r.node.id),3)],2),u("div",{class:f(r.$style.content)},[ee(r.$slots,"default",{},()=>[u("code",null,[A(" x: "+L(r.node.x)+" ",1),ge,A(" y: "+L(r.node.y),1)])])],2),u("div",{class:f([r.$style.connectionPoint,r.$style.connectionPointOutput]),onMousedownPassiveCapture:N(d,["stop"])},null,34)],6))}}),xe="-Tv-t",_e="nFLhm",Me="Z4UnU",Ce="VIIEU",Ee="fRrnA",Pe="Ghvw7",Ne="z8Xwe",Ie="_6g8aO",Fe="dUB-2",Le={root:xe,dragging:_e,selected:Me,header:Ce,text:Ee,content:Pe,connectionPoint:Ne,connectionPointInput:Ie,connectionPointOutput:Fe},ke={$style:Le},Se=F(we,[["__cssModules",ke]]),Be=I({__name:"FlowChart",props:{value:{}},emits:["update:value"],setup(w){const h=w,v=g(),o=g(),c=g(!1),d=g(),r=g(),p=g({}),_=g({}),y=g(),C=(e,n)=>`${e}:${n}`,B=(e,n)=>{const t=p.value[e],s=p.value[n];return{end:{id:s.id,x:s.x+P.width/2,y:s.y},start:{id:t.id,x:t.x+P.width/2,y:t.y+P.height}}},G=(e,n,t,s)=>{if(p.value[e])throw new Error(`Node with id ${e} already exists`);if(p.value[e]={id:e,inputId:s,outputIds:new Set,x:n,y:t},s){const l=p.value[s];l&&(l.outputIds.add(e),_.value[C(s,e)]=B(s,e))}},Z=(e,n,t)=>{const s=p.value[e];if(!s)throw new Error(`Node with id ${e} does not exist`);if(s.x+=n,s.y+=t,s.inputId){const l=_.value[C(s.inputId,s.id)];l&&(l.end.x+=n,l.end.y+=t)}for(const l of s.outputIds){const i=_.value[C(s.id,l)];i&&(i.start.x+=n,i.start.y+=t)}},j=(e,n)=>{const t=p.value[e];if(!t)throw new Error(`Node with id ${e} does not exist`);if(t.inputId){const s=p.value[t.inputId];if(s){s.outputIds.delete(e);const l=C(t.inputId,e);delete _.value[l]}}if(t.inputId=n,n){const s=p.value[n];if(s){s.outputIds.add(e);const l=C(n,e);_.value[l]=B(n,e)}}},D=(e,n)=>{const t=new Set,s=[e];for(;s.length>0;){const l=s.pop();if(l===n)return!0;if(!t.has(l)){t.add(l);const i=p.value[l];if(i)for(const x of i.outputIds)s.push(x)}}return!1},a=T({center:{x:0,y:0},position:{left:0,top:0},scale:1}),m=T({current:{x:0,y:0},start:{x:0,y:0}}),H=e=>{o.value&&cancelAnimationFrame(o.value),o.value=requestAnimationFrame(()=>{const n=a.scale,t=Math.min(Math.max(Math.exp(Math.log(a.scale)+Math.sign(-e.deltaY)*ae),X.min),X.max),s=e.clientX-a.position.left,l=e.clientY-a.position.top,i=t/n;a.center.x-=(s-a.center.x)*(i-1),a.center.y-=(l-a.center.y)*(i-1),a.scale=t})},W=e=>{c.value=!0,r.value=void 0,m.start.x=e.clientX,m.start.y=e.clientY},O=e=>{e.stopPropagation(),d.value!==void 0&&(r.value=d.value),c.value=!1,d.value=void 0,y.value=void 0},U=e=>{e.preventDefault(),e.stopPropagation(),m.current.x=e.clientX,m.current.y=e.clientY,o.value&&cancelAnimationFrame(o.value),o.value=requestAnimationFrame(()=>{const n=m.current.x-m.start.x,t=m.current.y-m.start.y;c.value&&(a.center.x+=n,a.center.y+=t),d.value!==void 0&&Z(d.value,n/a.scale,t/a.scale),y.value!==void 0&&(y.value.end.x+=n/a.scale,y.value.end.y+=t/a.scale),m.start.x=m.current.x,m.start.y=m.current.y})},K=e=>{d.value=e},J=e=>{const n=p.value[e],t=n.x+P.width/2,s=n.y+P.height;y.value={end:{x:t,y:s},start:{id:n.id,x:t,y:s}}},Q=e=>{if(y.value!==void 0){const{id:n}=y.value.start;if(n!==e){if(D(e,y.value.start.id))throw new Error(`Cyclic dependency was found: ${e} and ${n}`);j(e,n)}}};return te(()=>{if(h.value)for(const e in h.value){const n=h.value[e];G(n.id,n.x,n.y,n.parentId)}if(v.value){const{left:e,top:n}=v.value.getBoundingClientRect();a.position.left=e,a.position.top=n,a.center.x=v.value.clientWidth/2,a.center.y=v.value.clientHeight/2}document.documentElement.addEventListener("mousemove",U,!0),document.documentElement.addEventListener("mouseup",O,{capture:!1,passive:!0})}),ne(()=>{document.documentElement.removeEventListener("mousemove",U),document.documentElement.removeEventListener("mouseup",O)}),(e,n)=>($(),M("div",{class:f(e.$style.root),onMousedownPassive:N(W,["stop"]),onWheelPassiveCapture:N(H,["stop"]),ref_key:"rootEl",ref:v},[u("div",{class:f(e.$style.renderer)},[se(pe,{scene:a},null,8,["scene"]),u("div",{class:f(e.$style.blocks),style:R({transform:`translate3d(${a.center.x}px, ${a.center.y}px, 0) scale(${a.scale})`})},[u("div",{class:f(e.$style.center)},null,2),($(!0),M(V,null,Y(_.value,(t,s,l,i)=>{const x=[t.start.x,t.start.y,t.start.id,t.end.x,t.end.y,t.end.id];if(i&&i.key===s&&z(i,x))return i;const E=($(),k(q,{key:s,line:t},null,8,["line"]));return E.memo=x,E},n,0),128)),y.value?($(),k(q,{key:`${y.value.start.id}:${y.value.end.id}`,line:y.value},null,8,["line"])):oe("",!0),($(!0),M(V,null,Y(p.value,(t,s,l,i)=>{const x=[t.x,t.y,t.id===d.value,t.id===r.value];if(i&&i.key===t.id&&z(i,x))return i;const E=($(),k(Se,{dragging:t.id===d.value,key:t.id,node:t,selected:t.id===r.value,onInput:b=>Q(t.id),onMousedownPassive:N(b=>K(t.id),["stop"]),onOutput:b=>J(t.id)},null,8,["dragging","node","selected","onInput","onMousedownPassive","onOutput"]));return E.memo=x,E},n,2),128))],6)],2)],34))}}),Oe="uU08e",Ue="PItfu",be="RdVIc",Ae="jhgcs",Te={root:Oe,renderer:Ue,blocks:be,center:Ae},Ve={$style:Te},ze=F(Be,[["__cssModules",Ve]]);export{ze as F};
