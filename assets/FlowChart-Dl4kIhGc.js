import{d as M,a as S,o as $,b as x,e as c,n as m,_ as E,t as I,f as Z,g as z,h as B,r as f,i as O,j,k as H,l as W,F as U,m as b,w as C,p as A,c as T}from"./index-52XwtxVT.js";const Y={max:2,min:.1},K=.2,N={height:98,width:168},J=["height","patternTransform","width","x","y"],Q=["cx","cy","r"],ee=c("rect",{fill:"url(#dots-pattern)",height:"100%",width:"100%",x:"0",y:"0"},null,-1),te=M({__name:"FlowChartGrid",props:{scene:{}},setup(h){const v=h,n=S(()=>40*v.scene.scale),s=S(()=>2*v.scene.scale);return(l,u)=>($(),x("svg",{class:m(l.$style.root)},[c("pattern",{height:n.value,patternTransform:`translate(-${s.value},-${s.value})`,width:n.value,x:l.scene.center.x,y:l.scene.center.y,id:"dots-pattern",patternUnits:"userSpaceOnUse"},[c("circle",{cx:s.value,cy:s.value,r:s.value/2},null,8,Q)],8,J),ee],2))}}),ne="-H6Fm",se={root:ne},oe={$style:se},re=E(te,[["__cssModules",oe]]),ae=["d"],le=M({__name:"FlowChartLine",props:{line:{}},setup(h){const v=h,n=S(()=>{const{end:s,start:l}=v.line,u=Math.sqrt((s.x-l.x)*(s.x-l.x)+(s.y-l.y)*(s.y-l.y))*.25;return`M ${l.x}, ${l.y} C ${l.x}, ${l.y+u}, ${s.x}, ${s.y-u}, ${s.x}, ${s.y}`});return(s,l)=>($(),x("svg",{class:m(s.$style.root),height:"100%",width:"100%"},[c("g",null,[c("path",{d:n.value},null,8,ae)])],2))}}),ce="_4PhXY",ie={root:ce},ue={$style:ie},de=E(le,[["__cssModules",ue]]),me=["id"],ve=c("br",null,null,-1),ye=M({__name:"FlowChartNode",props:{dragging:{type:Boolean},node:{},selected:{type:Boolean}},setup(h){const v=h;return(n,s)=>($(),x("div",{class:m([n.$style.root,{[n.$style.dragging]:n.dragging,[n.$style.selected]:n.selected}]),id:String(n.node.id),style:z({transform:`translate3d(${v.node.x}px, ${v.node.y}px, 0)`})},[c("div",{class:m([n.$style.connectionPoint,n.$style.connectionPointInput])},null,2),c("div",{class:m(n.$style.header)},[c("span",{class:m(n.$style.text)}," id: "+I(n.node.id),3)],2),c("div",{class:m(n.$style.content)},[Z(n.$slots,"default",{},()=>[c("code",null,[B(" x: "+I(n.node.x)+" ",1),ve,B(" y: "+I(n.node.y),1)])])],2),c("div",{class:m([n.$style.connectionPoint,n.$style.connectionPointOutput])},null,2)],14,me))}}),pe="-Tv-t",$e="nFLhm",he="Z4UnU",ge="VIIEU",fe="fRrnA",xe="Ghvw7",_e="z8Xwe",we="_6g8aO",Me="dUB-2",Ee={root:pe,dragging:$e,selected:he,header:ge,text:fe,content:xe,connectionPoint:_e,connectionPointInput:we,connectionPointOutput:Me},Pe={$style:Ee},Fe=E(ye,[["__cssModules",Pe]]),Ie=M({__name:"FlowChart",props:{value:{}},emits:["update:value"],setup(h){const v=h,n=f(),s=f(null),l=f(!1),u=f(null),P=f(null),w=f({}),g=f({}),F=(e,o)=>`${e}:${o}`,V=(e,o)=>{const t=g.value[e],a=g.value[o];return{end:{id:a.id,x:a.x+N.width/2,y:a.y},start:{id:t.id,x:t.x+N.width/2,y:t.y+N.height}}},X=(e,o,t,a)=>{if(g.value[e])throw new Error(`Node with id ${e} already exists`);if(g.value[e]={id:e,inputId:a,outputIds:new Set,x:o,y:t},a){const y=g.value[a];y&&(y.outputIds.add(e),w.value[F(a,e)]=V(a,e))}},R=(e,o,t)=>{const a=g.value[e];if(!a)throw new Error(`Node with id ${e} does not exist`);a.x+=o,a.y+=t;const y=w.value[F(a.inputId,a.id)];y&&(y.end.x+=o,y.end.y+=t);for(const i of a.outputIds){const p=w.value[F(a.id,i)];p&&(p.start.x+=o,p.start.y+=t)}},r=O({center:{x:0,y:0},position:{left:0,top:0},scale:1}),d=O({current:{x:0,y:0},start:{x:0,y:0}}),q=e=>{s.value&&cancelAnimationFrame(s.value),s.value=requestAnimationFrame(()=>{const o=r.scale,t=Math.min(Math.max(Math.exp(Math.log(r.scale)+Math.sign(-e.deltaY)*K),Y.min),Y.max),a=e.clientX-r.position.left,y=e.clientY-r.position.top,i=t/o;r.center.x-=(a-r.center.x)*(i-1),r.center.y-=(y-r.center.y)*(i-1),r.scale=t})},D=e=>{l.value=!0,d.start.x=e.clientX,d.start.y=e.clientY},k=e=>{e.preventDefault(),e.stopPropagation(),u.value!==null&&(P.value=u.value),l.value=!1,u.value=null},L=e=>{e.preventDefault(),e.stopPropagation(),d.current.x=e.clientX,d.current.y=e.clientY,s.value&&cancelAnimationFrame(s.value),s.value=requestAnimationFrame(()=>{const o=d.current.x-d.start.x,t=d.current.y-d.start.y;l.value&&(r.center.x+=o,r.center.y+=t),u.value!==null&&R(u.value,o/r.scale,t/r.scale),d.start.x=d.current.x,d.start.y=d.current.y})},G=e=>{u.value=e};return j(()=>{if(v.value)for(const e in v.value){const o=v.value[e];X(o.id,o.x,o.y,o.parentId)}if(n.value){const{left:e,top:o}=n.value.getBoundingClientRect();r.position.left=e,r.position.top=o,r.center.x=n.value.clientWidth/2,r.center.y=n.value.clientHeight/2}document.documentElement.addEventListener("mousemove",L,!0),document.documentElement.addEventListener("mouseup",k,!0)}),H(()=>{document.documentElement.removeEventListener("mousemove",L),document.documentElement.removeEventListener("mouseup",k)}),(e,o)=>($(),x("div",{class:m(e.$style.root),onMousedownPassive:C(D,["stop"]),onWheelPassiveCapture:C(q,["stop"]),ref_key:"rootEl",ref:n},[c("div",{class:m(e.$style.renderer)},[W(re,{scene:r},null,8,["scene"]),c("div",{class:m(e.$style.blocks),style:z({transform:`translate3d(${r.center.x}px, ${r.center.y}px, 0) scale(${r.scale})`})},[c("div",{class:m(e.$style.center)},null,2),($(!0),x(U,null,b(w.value,(t,a,y,i)=>{const p=[t.start.x,t.start.y,t.start.id,t.end.x,t.end.y,t.end.id];if(i&&i.key===`${t.start.id}-${t.end.id}`&&A(i,p))return i;const _=($(),T(de,{key:`${t.start.id}-${t.end.id}`,line:t},null,8,["line"]));return _.memo=p,_},o,0),128)),($(!0),x(U,null,b(g.value,(t,a,y,i)=>{const p=[t.x,t.y,t.id===u.value,t.id===P.value];if(i&&i.key===t.id&&A(i,p))return i;const _=($(),T(Fe,{dragging:t.id===u.value,key:t.id,node:t,selected:t.id===P.value,onMousedownPassive:C(Oe=>G(t.id),["stop"])},null,8,["dragging","node","selected","onMousedownPassive"]));return _.memo=p,_},o,2),128))],6)],2)],34))}}),Ce="uU08e",Ne="PItfu",Se="RdVIc",ke="jhgcs",Le={root:Ce,renderer:Ne,blocks:Se,center:ke},Be={$style:Le},be=E(Ie,[["__cssModules",Be]]);export{be as F};
