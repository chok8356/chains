import{d as k,a as O,o as h,b as M,e as l,n as v,_ as L,r as $,t as S,f as ee,g as q,w as F,h as A,i as te,j as ne,k as oe,l as se,F as V,m as X,c as B,p as ue,q as Y}from"./index-DsDxjDDC.js";const z={max:2,min:.1},ae=.2,E={height:98,width:168},ie=["height","patternTransform","width","x","y"],re=["cx","cy","r"],ce=l("rect",{fill:"url(#dots-pattern)",height:"100%",width:"100%",x:"0",y:"0"},null,-1),le=k({__name:"FlowChartGrid",props:{scene:{}},setup(g){const y=g,m=O(()=>40*y.scene.scale),u=O(()=>2*y.scene.scale);return(i,r)=>(h(),M("svg",{class:v(i.$style.root)},[l("pattern",{height:m.value,patternTransform:`translate(-${u.value},-${u.value})`,width:m.value,x:i.scene.center.x,y:i.scene.center.y,id:"dots-pattern",patternUnits:"userSpaceOnUse"},[l("circle",{cx:u.value,cy:u.value,r:u.value/2},null,8,re)],8,ie),ce],2))}}),de="-H6Fm",pe={root:de},ve={$style:pe},me=L(le,[["__cssModules",ve]]),ye=["d"],fe=k({__name:"FlowChartLine",props:{line:{}},setup(g){const y=g,m=O(()=>{const{end:u,start:i}=y.line,r=Math.sqrt((u.x-i.x)*(u.x-i.x)+(u.y-i.y)*(u.y-i.y))*.25;return`M ${i.x}, ${i.y} C ${i.x}, ${i.y+r}, ${u.x}, ${u.y-r}, ${u.x}, ${u.y}`});return(u,i)=>(h(),M("svg",{class:v(u.$style.root)},[l("path",{d:m.value},null,8,ye)],2))}}),$e="_4PhXY",he={root:$e},ge={$style:he},b=L(fe,[["__cssModules",ge]]),we=l("br",null,null,-1),xe=k({__name:"FlowChartNode",props:{dragging:{type:Boolean},node:{},selected:{type:Boolean}},emits:["input","mousedown","mouseup","output"],setup(g,{emit:y}){const m=g,u=y,i=$(),r=$();function f(n){n.target===r.value?u("output"):u("mousedown")}function x(n){n.target===i.value?u("input"):u("mouseup")}return(n,d)=>(h(),M("div",{class:v([n.$style.root,{[n.$style.dragging]:n.dragging,[n.$style.selected]:n.selected}]),style:q({transform:`translate3d(${m.node.x}px, ${m.node.y}px, 0)`}),onMousedownPassiveCapture:F(f,["stop"]),onMouseupPassiveCapture:F(x,["stop"])},[l("div",{class:v([n.$style.connectionPoint,n.$style.connectionPointInput]),ref_key:"input",ref:i},null,2),l("div",{class:v(n.$style.header)},[l("span",{class:v(n.$style.text)}," id: "+S(n.node.id),3)],2),l("div",{class:v(n.$style.content)},[ee(n.$slots,"default",{},()=>[l("code",null,[A(" x: "+S(n.node.x)+" ",1),we,A(" y: "+S(n.node.y),1)])])],2),l("div",{class:v([n.$style.connectionPoint,n.$style.connectionPointOutput]),ref_key:"output",ref:r},null,2)],38))}}),_e="-Tv-t",Me="nFLhm",Ne="Z4UnU",Ce="VIIEU",Ee="fRrnA",Fe="Ghvw7",ke="z8Xwe",Le="_6g8aO",Pe="dUB-2",Ie={root:_e,dragging:Me,selected:Ne,header:Ce,text:Ee,content:Fe,connectionPoint:ke,connectionPointInput:Le,connectionPointOutput:Pe},Se={$style:Ie},Be=L(xe,[["__cssModules",Se]]),Oe=k({__name:"FlowChart",props:{value:{}},emits:["update:value"],setup(g){const y=g,m=$();let u=null;const i=$(!1),r=$(),f=$(),x=$(),n=te({center:{x:0,y:0},position:{left:0,top:0},scale:1}),d={current:{x:0,y:0},start:{x:0,y:0}},p=$({}),_=$({}),N=(e,o)=>`${e}:${o}`;function U(e,o){const t=p.value[e],s=p.value[o];return{end:{id:s.id,x:s.x+E.width/2,y:s.y},start:{id:t.id,x:t.x+E.width/2,y:t.y+E.height}}}function j(e,o,t,s){if(p.value[e])throw new Error(`Node with id ${e} already exists`);if(p.value[e]={id:e,inputId:s,outputIds:new Set,x:o,y:t},s){const a=p.value[s];a&&(a.outputIds.add(e),_.value[N(s,e)]=U(s,e))}}function G(e,o,t){const s=p.value[e];if(!s)throw new Error(`Node with id ${e} does not exist`);if(s.x+=o,s.y+=t,s.inputId){const a=_.value[N(s.inputId,s.id)];a&&(a.end.x+=o,a.end.y+=t)}for(const a of s.outputIds){const c=_.value[N(s.id,a)];c&&(c.start.x+=o,c.start.y+=t)}}function R(e,o){const t=p.value[e];if(!t)throw new Error(`Node with id ${e} does not exist`);if(t.inputId){const s=p.value[t.inputId];if(s){s.outputIds.delete(e);const a=N(t.inputId,e);delete _.value[a]}}if(t.inputId=o,o){const s=p.value[o];if(s){s.outputIds.add(e);const a=N(o,e);_.value[a]=U(o,e)}}}function Z(e,o){const t=new Set,s=[e];for(;s.length>0;){const a=s.pop();if(a===o)return!0;if(!t.has(a)){t.add(a);const c=p.value[a];if(c)for(const w of c.outputIds)s.push(w)}}return!1}function D(e){const o=n.scale,t=Math.min(Math.max(Math.exp(Math.log(n.scale)+Math.sign(-e.deltaY)*ae),z.min),z.max),s=e.clientX-n.position.left,a=e.clientY-n.position.top,c=t/o;u&&cancelAnimationFrame(u),u=requestAnimationFrame(()=>{n.center.x-=(s-n.center.x)*(c-1),n.center.y-=(a-n.center.y)*(c-1),n.scale=t})}function H(e){i.value=!0,x.value=void 0,d.start.x=e.clientX,d.start.y=e.clientY}function P(){setTimeout(()=>{f.value!==void 0&&(x.value=f.value),i.value=!1,f.value=void 0,r.value=void 0},0)}function T(e){e.preventDefault(),e.stopPropagation(),d.current.x=e.clientX,d.current.y=e.clientY;const o=d.current.x-d.start.x,t=d.current.y-d.start.y;u&&cancelAnimationFrame(u),u=requestAnimationFrame(()=>{i.value&&(n.center.x+=o,n.center.y+=t),f.value!==void 0&&G(f.value,o/n.scale,t/n.scale),r.value!==void 0&&(r.value.end.x+=o/n.scale,r.value.end.y+=t/n.scale),d.start.x=d.current.x,d.start.y=d.current.y})}function K(e){f.value=e}function Q(){P()}function W(e){const o=p.value[e],t=o.x+E.width/2,s=o.y+E.height;r.value={end:{x:t,y:s},start:{id:o.id,x:t,y:s}}}function J(e){if(r.value!==void 0){const{id:o}=r.value.start;if(o!==e){if(Z(e,r.value.start.id))throw new Error(`Cyclic dependency was found: ${e} and ${o}`);R(e,o)}}}return ne(()=>{if(y.value)for(const e in y.value){const o=y.value[e];j(o.id,o.x,o.y,o.parentId)}if(m.value){const{height:e,left:o,top:t,width:s}=m.value.getBoundingClientRect();n.position.left=o,n.position.top=t,n.center.x=s/2,n.center.y=e/2}document.documentElement.addEventListener("mousemove",T,!0),document.documentElement.addEventListener("mouseup",P,!0)}),oe(()=>{document.documentElement.removeEventListener("mousemove",T),document.documentElement.removeEventListener("mouseup",P)}),(e,o)=>(h(),M("div",{class:v(e.$style.root),onMousedownPassive:F(H,["stop"]),onWheelPassiveCapture:F(D,["stop"]),ref_key:"rootEl",ref:m},[se(me,{scene:n},null,8,["scene"]),l("div",{class:v(e.$style.scene),style:q({transform:`translate3d(${n.center.x}px, ${n.center.y}px, 0) scale(${n.scale})`})},[l("div",{class:v(e.$style.center)},null,2),l("div",{class:v(e.$style.lines)},[(h(!0),M(V,null,X(_.value,(t,s,a,c)=>{const w=[t.start.x,t.start.y,t.start.id,t.end.x,t.end.y,t.end.id];if(c&&c.key===s&&Y(c,w))return c;const C=(h(),B(b,{key:s,line:t},null,8,["line"]));return C.memo=w,C},o,0),128))],2),r.value?(h(),B(b,{key:`${r.value.start.id}:${r.value.end.id}`,line:r.value},null,8,["line"])):ue("",!0),(h(!0),M(V,null,X(p.value,(t,s,a,c)=>{const w=[t.x,t.y,t.id===f.value,t.id===x.value];if(c&&c.key===t.id&&Y(c,w))return c;const C=(h(),B(Be,{dragging:t.id===f.value,key:t.id,node:t,selected:t.id===x.value,onInput:I=>J(t.id),onMousedown:I=>K(t.id),onMouseup:o[2]||(o[2]=I=>Q()),onOutput:I=>W(t.id)},null,8,["dragging","node","selected","onInput","onMousedown","onOutput"]));return C.memo=w,C},o,3),128))],6)],34))}}),Ue="uU08e",Te="-X2kt",Ae="jhgcs",Ve="QBVNj",Xe={root:Ue,scene:Te,center:Ae,lines:Ve},Ye={$style:Xe},be=L(Oe,[["__cssModules",Ye]]);export{be as F};
