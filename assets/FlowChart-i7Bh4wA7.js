import{d as O,a as B,o as g,b as C,e as v,n as f,_ as L,r as $,t as T,f as lt,g as U,w as I,h as A,i as rt,j as ut,k as it,l as dt,F as V,m as z,c as P,p as R,q as D}from"./index-BwxVuoaw.js";const j={max:2,min:.1},pt=.2,w={height:98,width:168},vt=["height","patternTransform","width","x","y"],yt=["cx","cy","r"],ft=v("rect",{fill:"url(#dots-pattern)",height:"100%",width:"100%",x:"0",y:"0"},null,-1),mt=O({__name:"FlowChartGrid",props:{scene:{}},setup(_){const h=_,x=B(()=>40*h.scene.scale),a=B(()=>2*h.scene.scale);return(r,y)=>(g(),C("svg",{class:f(r.$style.root)},[v("pattern",{height:x.value,patternTransform:`translate(-${a.value},-${a.value})`,width:x.value,x:r.scene.center.x,y:r.scene.center.y,id:"dots-pattern",patternUnits:"userSpaceOnUse"},[v("circle",{cx:a.value,cy:a.value,r:a.value/2},null,8,yt)],8,vt),ft],2))}}),ht="-H6Fm",xt={root:ht},$t={$style:xt},gt=L(mt,[["__cssModules",$t]]),wt=["d"],_t=O({__name:"FlowChartLine",props:{line:{}},setup(_){const h=_,x=B(()=>{const{end:a,start:r}=h.line,y=Math.sqrt((a.x-r.x)*(a.x-r.x)+(a.y-r.y)*(a.y-r.y))*.25;return`M ${r.x}, ${r.y} C ${r.x}, ${r.y+y}, ${a.x}, ${a.y-y}, ${a.x}, ${a.y}`});return(a,r)=>(g(),C("svg",{class:f(a.$style.root)},[v("path",{d:x.value},null,8,wt)],2))}}),Mt="_4PhXY",St={root:Mt},Ct={$style:St},G=L(_t,[["__cssModules",Ct]]),Et=v("br",null,null,-1),Nt=O({__name:"FlowChartNode",props:{dragging:{type:Boolean},node:{},selected:{type:Boolean}},emits:["input-end","input-start","mousedown","mouseup","output-start"],setup(_,{emit:h}){const x=_,a=h,r=$(),y=$();function M(s){if(s.target===r.value){a("input-start",s);return}if(s.target===y.value){a("output-start",s);return}a("mousedown",s)}function d(s){if(s.target===r.value){a("input-end",s);return}a("mouseup",s)}return(s,k)=>(g(),C("div",{class:f([s.$style.root,{[s.$style.dragging]:s.dragging,[s.$style.selected]:s.selected}]),style:U({transform:`translate3d(${x.node.x}px, ${x.node.y}px, 0)`}),onMousedownPassiveCapture:I(M,["stop"]),onMouseupPassiveCapture:I(d,["stop"])},[v("div",{class:f([s.$style.connectionPoint,s.$style.connectionPointInput]),ref_key:"input",ref:r},null,2),v("div",{class:f(s.$style.header)},[v("span",{class:f(s.$style.text)}," id: "+T(s.node.id),3)],2),v("div",{class:f(s.$style.content)},[lt(s.$slots,"default",{},()=>[v("code",null,[A(" x: "+T(s.node.x)+" ",1),Et,A(" y: "+T(s.node.y),1)])])],2),v("div",{class:f([s.$style.connectionPoint,s.$style.connectionPointOutput]),ref_key:"output",ref:y},null,2)],38))}}),kt="-Tv-t",Ft="nFLhm",Lt="Z4UnU",Pt="VIIEU",Bt="fRrnA",It="Ghvw7",Ot="z8Xwe",Tt="_6g8aO",Ut="dUB-2",Xt={root:kt,dragging:Ft,selected:Lt,header:Pt,text:Bt,content:It,connectionPoint:Ot,connectionPointInput:Tt,connectionPointOutput:Ut},Yt={$style:Xt},bt=L(Nt,[["__cssModules",Yt]]),qt="nqxdq",At={root:qt},Vt={};function zt(_,h){return g(),C("div",{class:f(_.$style.root)},null,2)}const Rt={$style:At},Dt=L(Vt,[["render",zt],["__cssModules",Rt]]),jt=O({__name:"FlowChart",props:{value:{}},emits:["update:value"],setup(_){const h=_,x=$();let a=null;const r=$(!1),y=$(!1),M=$(!1),d=$(),s=$(new Set),k=$({end:{x:0,y:0},start:{x:0,y:0}}),K=B(()=>{const{end:t,start:e}=k.value,n=Math.abs(e.x-t.x),o=Math.abs(e.y-t.y),u=t.x<e.x?t.x:e.x,l=t.y<e.y?t.y:e.y;return{height:`${o}px`,left:`${u}px`,top:`${l}px`,width:`${n}px`}}),c=rt({center:{x:0,y:0},position:{left:0,top:0},scale:1}),p={current:{x:0,y:0},start:{x:0,y:0}},i=$({}),E=$({}),F=(t,e)=>`${t}:${e}`;function X(t,e){const n=i.value[t],o=i.value[e];return{end:{id:o.id,x:o.x+w.width/2,y:o.y},start:{id:n.id,x:n.x+w.width/2,y:n.y+w.height}}}function Z(t,e,n,o){if(i.value[t])throw new Error(`Node with id ${t} already exists`);if(i.value[t]={id:t,inputId:o,outputIds:new Set,x:e,y:n},o){const u=i.value[o];u&&(u.outputIds.add(t),E.value[F(o,t)]=X(o,t))}}function H(t,e,n){const o=i.value[t];if(!o)throw new Error(`Node with id ${t} does not exist`);if(o.x+=e,o.y+=n,o.inputId){const u=E.value[F(o.inputId,o.id)];u&&(u.end.x+=e,u.end.y+=n)}for(const u of o.outputIds){const l=E.value[F(o.id,u)];l&&(l.start.x+=e,l.start.y+=n)}}function Y(t,e){const n=i.value[t];if(!n)throw new Error(`Node with id ${t} does not exist`);if(n.inputId!==void 0){const o=i.value[n.inputId];o&&(o.outputIds.delete(t),delete E.value[F(n.inputId,t)])}if(n.inputId=e,e!==void 0){const o=i.value[e];o&&(o.outputIds.add(t),E.value[F(e,t)]=X(e,t))}}function Q(t,e){const n=new Set,o=[t];for(;o.length>0;){const u=o.pop();if(u===e)return!0;if(!n.has(u)){n.add(u);const l=i.value[u];if(l)for(const m of l.outputIds)o.push(m)}}return!1}function W(t){const e=c.scale,n=Math.min(Math.max(Math.exp(Math.log(c.scale)+Math.sign(-t.deltaY)*pt),j.min),j.max),o=t.clientX-c.position.left,u=t.clientY-c.position.top,l=n/e;a&&cancelAnimationFrame(a),a=requestAnimationFrame(()=>{c.center.x-=(o-c.center.x)*(l-1),c.center.y-=(u-c.center.y)*(l-1),c.scale=n})}function J(t){t.ctrlKey?(k.value={end:{x:t.clientX,y:t.clientY},start:{x:t.clientX,y:t.clientY}},M.value=!0):r.value=!0,s.value=new Set,p.start.x=t.clientX,p.start.y=t.clientY}function b(){setTimeout(()=>{if(M.value)for(const t in i.value){const e=i.value[t];st(e)&&s.value.add(e.id)}r.value=!1,y.value=!1,M.value=!1,d.value=void 0},0)}function q(t){t.preventDefault(),t.stopPropagation(),p.current.x=t.clientX,p.current.y=t.clientY;const e=p.current.x-p.start.x,n=p.current.y-p.start.y;a&&cancelAnimationFrame(a),a=requestAnimationFrame(()=>{if(r.value&&(c.center.x+=e,c.center.y+=n),M.value&&(k.value.end={x:p.current.x,y:p.current.y}),y.value)for(const o of s.value)H(o,e/c.scale,n/c.scale);d.value!==void 0&&(d.value.end.x+=e/c.scale,d.value.end.y+=n/c.scale),p.start.x=p.current.x,p.start.y=p.current.y})}function tt(t,e){t.ctrlKey?s.value.has(e)?s.value.delete(e):s.value.add(e):(s.value.has(e)||(s.value=new Set([e])),y.value=!0)}function et(t){const e=i.value[t],n=e.x+w.width/2,o=e.y+w.height;d.value={end:{id:void 0,x:n,y:o},start:{id:e.id,x:n,y:o}}}function nt(t){const e=i.value[t];if(e.inputId!==void 0){const n=i.value[e.inputId];d.value={end:{id:void 0,x:e.x+w.width/2,y:e.y},start:{id:n.id,x:n.x+w.width/2,y:n.y+w.height}},Y(t,void 0)}}function ot(t){if(d.value!==void 0){const{id:e}=d.value.start;if(e!==t){if(Q(t,e))throw new Error(`Cyclic dependency was found: ${t} and ${e}`);Y(t,e)}}}function st(t){const e=t.x*c.scale+c.center.x,n=t.y*c.scale+c.center.y,o=e+w.width*c.scale,u=n+w.height*c.scale,{end:l,start:m}=k.value,S=Math.min(m.x,l.x),N=Math.max(m.x,l.x),at=Math.min(m.y,l.y),ct=Math.max(m.y,l.y);return e>S&&o<N&&n>at&&u<ct}return ut(()=>{if(h.value)for(const t in h.value){const e=h.value[t];Z(e.id,e.x,e.y,e.parentId)}if(x.value){const{height:t,left:e,top:n,width:o}=x.value.getBoundingClientRect();c.position.left=e,c.position.top=n,c.center.x=o/2,c.center.y=t/2}document.documentElement.addEventListener("mousemove",q,!0),document.documentElement.addEventListener("mouseup",b,!0)}),it(()=>{document.documentElement.removeEventListener("mousemove",q),document.documentElement.removeEventListener("mouseup",b)}),(t,e)=>(g(),C("div",{class:f(t.$style.root),onMousedownPassive:I(J,["stop"]),onWheelCapture:I(W,["prevent","stop"]),ref_key:"rootEl",ref:x},[dt(gt,{scene:c},null,8,["scene"]),v("div",{class:f(t.$style.scene),style:U({transform:`translate3d(${c.center.x}px, ${c.center.y}px, 0) scale(${c.scale})`})},[v("div",{class:f(t.$style.center)},null,2),v("div",{class:f(t.$style.lines)},[(g(!0),C(V,null,z(E.value,(n,o,u,l)=>{const m=[n.start.x,n.start.y,n.start.id,n.end.x,n.end.y,n.end.id];if(l&&l.key===o&&D(l,m))return l;const S=(g(),P(G,{key:o,line:n},null,8,["line"]));return S.memo=m,S},e,0),128))],2),d.value?(g(),P(G,{key:`${d.value.start.id}:${d.value.end.id}`,line:d.value},null,8,["line"])):R("",!0),(g(!0),C(V,null,z(i.value,(n,o,u,l)=>{const m=[n.x,n.y,y.value,s.value.has(n.id)];if(l&&l.key===n.id&&D(l,m))return l;const S=(g(),P(bt,{dragging:y.value&&s.value.has(n.id),key:n.id,node:n,selected:s.value.has(n.id),onInputEnd:N=>ot(n.id),onInputStart:N=>nt(n.id),onMousedown:N=>tt(N,n.id),onOutputStart:N=>et(n.id)},null,8,["dragging","node","selected","onInputEnd","onInputStart","onMousedown","onOutputStart"]));return S.memo=m,S},e,2),128))],6),M.value?(g(),P(Dt,{key:0,style:U(K.value)},null,8,["style"])):R("",!0)],34))}}),Gt="uU08e",Kt="-X2kt",Zt="jhgcs",Ht="QBVNj",Qt={root:Gt,scene:Kt,center:Zt,lines:Ht},Wt={$style:Qt},te=L(jt,[["__cssModules",Wt]]);export{te as F};
